<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Networth Dynamics Calculator</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
            background-color: #f9f9f9;
        }
        h2 {
            text-align: center;
            color: #333;
        }
        .entry {
            margin-bottom: 15px;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            display: grid;
            grid-template-columns: auto 1fr auto 1fr auto 1fr auto 1fr auto;
            align-items: center;
            gap: 5px;
            background-color: #fff;
        }
        .entry label {
            font-weight: bold;
            color: #555;
        }
        .entry input, .entry select {
            padding: 5px;
            border: 1px solid #ddd;
            border-radius: 3px;
        }
        button {
            padding: 10px 15px;
            cursor: pointer;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            margin: 5px;
        }
        button:hover {
            background-color: #45a049;
        }
        .removeBtn {
            background-color: #f44336;
        }
        .removeBtn:hover {
            background-color: #d32f2f;
        }
        #results {
            margin-top: 20px;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            background-color: #fff;
        }
        #results p {
            margin: 5px 0;
        }
        #graph {
            margin-top: 20px;
            background-color: #fff;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }
        .projection {
            text-align: center;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        function App() {
            const [entries, setEntries] = useState([
                { id: 0, principal: '', rate: '', type: 'asset', compounding: 'none' }
            ]);
            const [nextId, setNextId] = useState(1);
            const [results, setResults] = useState(null);
            const [projectionYears, setProjectionYears] = useState(10);
            const chartRef = useRef(null);
            const chartInstance = useRef(null);

            useEffect(() => {
                const saved = localStorage.getItem('calculatorData');
                if (saved) {
                    const { entries: savedEntries, projectionYears: savedYears, nextId: savedNextId } = JSON.parse(saved);
                    setEntries(savedEntries);
                    setProjectionYears(savedYears);
                    setNextId(savedNextId);
                }
            }, []);

            useEffect(() => {
                localStorage.setItem('calculatorData', JSON.stringify({ entries, projectionYears, nextId }));
            }, [entries, projectionYears, nextId]);

            const addEntry = () => {
                setEntries([...entries, { id: nextId, principal: '', rate: '', type: 'asset', compounding: 'none' }]);
                setNextId(nextId + 1);
            };

            const removeEntry = (id) => {
                if (entries.length > 1) {
                    setEntries(entries.filter(entry => entry.id !== id));
                } else {
                    alert("At least one entry is required!");
                }
            };

            const updateEntry = (id, field, value) => {
                setEntries(entries.map(entry => {
                    if (entry.id === id) {
                        let newEntry = { ...entry, [field]: value };
                        if (field === 'type') {
                            let r = parseFloat(newEntry.rate) || 0;
                            if (newEntry.type === 'debt') {
                                r = -Math.abs(r);
                            }
                            newEntry.rate = r.toString();
                        } else if (field === 'rate') {
                            let r = parseFloat(value) || 0;
                            if (newEntry.type === 'debt') {
                                r = -Math.abs(r);
                            }
                            newEntry.rate = r.toString();
                        }
                        return newEntry;
                    }
                    return entry;
                }));
            };

            const calculateFV = (principal, annualRate, years, compounding) => {
                if (years === 0) return principal;
                if (compounding === 'none') {
                    return principal * (1 + annualRate * years);
                } else {
                    let periodsPerYear = 1;
                    if (compounding === 'annual') periodsPerYear = 1;
                    if (compounding === 'monthly') periodsPerYear = 12;
                    else if (compounding === 'daily') periodsPerYear = 365;
                    const periodRate = annualRate / periodsPerYear;
                    const totalPeriods = years * periodsPerYear;
                    return principal * Math.pow(1 + periodRate, totalPeriods);
                }
            };

            const calculate = () => {
                let totalAnnualInterest = 0;
                let assetsPrincipal = 0;
                let debtsPrincipal = 0;

                entries.forEach(entry => {
                    const principal = parseFloat(entry.principal) || 0;
                    const rate = parseFloat(entry.rate) || 0;

                    totalAnnualInterest += principal * (rate / 100);

                    if (entry.type === 'asset') {
                        assetsPrincipal += principal;
                    } else {
                        debtsPrincipal += principal;
                    }
                });

                const netWorth = assetsPrincipal - debtsPrincipal;
                const absNetWorth = Math.abs(netWorth);
                const netPercentage = absNetWorth !== 0 ? (totalAnnualInterest / absNetWorth * 100).toFixed(2) : 0;
                const dailyInterest = (totalAnnualInterest / 365).toFixed(2);

                setResults({
                    netWorth,
                    totalAnnualInterest,
                    dailyInterest,
                    netPercentage
                });

                // Project networth
                const networthData = [];
                for (let year = 0; year <= projectionYears; year++) {
                    let totalFV = 0;
                    entries.forEach(entry => {
                        const principal = parseFloat(entry.principal) || 0;
                        const rate = parseFloat(entry.rate) || 0;
                        let entryRate = Math.abs(rate / 100);
                        let sign = entry.type === 'debt' ? -1 : 1;
                        if (entry.type === 'asset' && rate < 0) {
                            entryRate = -entryRate;
                        }
                        const fv = calculateFV(principal, entryRate, year, entry.compounding);
                        totalFV += sign * fv;
                    });
                    networthData.push(totalFV);
                }

                // Draw graph
                if (chartInstance.current) {
                    chartInstance.current.destroy();
                }
                const ctx = chartRef.current.getContext('2d');
                chartInstance.current = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: Array.from({ length: projectionYears + 1 }, (_, i) => `Year ${i}`),
                        datasets: [{
                            label: 'Projected Net Worth (RUB)',
                            data: networthData,
                            borderColor: 'rgba(75,192,192,1)',
                            backgroundColor: 'rgba(75,192,192,0.2)',
                            fill: true,
                        }]
                    },
                    options: {
                        scales: {
                            y: {
                                beginAtZero: false,
                                title: {
                                    display: true,
                                    text: 'Net Worth (RUB)'
                                }
                            },
                            x: {
                                title: {
                                    display: true,
                                    text: 'Years'
                                }
                            }
                        }
                    }
                });
            };

            useEffect(() => {
                calculate();
            }, [entries, projectionYears]);

            const getColor = (value) => {
                if (value > 0) return 'green';
                if (value < 0) return 'red';
                return 'black';
            };

            return (
                <div>
                    <h2>Asset & Debt Interest Calculator</h2>
                    {entries.map(entry => (
                        <div key={entry.id} className="entry">
                            <label>Principal</label>
                            <input
                                type="number"
                                value={entry.principal}
                                onChange={(e) => updateEntry(entry.id, 'principal', e.target.value)}
                            />
                            <label>Rate %</label>
                            <input
                                type="number"
                                step="0.1"
                                value={entry.type === 'debt' && parseFloat(entry.rate) === 0 ? '-0' : entry.rate}
                                onChange={(e) => updateEntry(entry.id, 'rate', e.target.value)}
                            />
                            <label>Type</label>
                            <select
                                value={entry.type}
                                onChange={(e) => updateEntry(entry.id, 'type', e.target.value)}
                            >
                                <option value="asset">Asset</option>
                                <option value="debt">Debt</option>
                            </select>
                            <label>Compounding</label>
                            <select
                                value={entry.compounding}
                                onChange={(e) => updateEntry(entry.id, 'compounding', e.target.value)}
                            >
                                <option value="none">No Compound</option>
                                <option value="annual">Annual</option>
                                <option value="monthly">Monthly</option>
                                <option value="daily">Daily</option>
                            </select>
                            <button className="removeBtn" onClick={() => removeEntry(entry.id)}>Remove</button>
                        </div>
                    ))}
                    <button onClick={addEntry}>Add Entry</button>
                    <div className="projection">
                        <label>Projection Years: </label>
                        <input
                            type="number"
                            value={projectionYears}
                            onChange={(e) => setProjectionYears(parseInt(e.target.value) || 10)}
                            min="1"
                            max="50"
                        />
                    </div>
                    {results && (
                        <div id="results">
                            <h3>Results</h3>
                            <p style={{color: getColor(results.netWorth)}}>Total Net Worth: {results.netWorth.toLocaleString()} RUB</p>
                            <p style={{color: getColor(results.totalAnnualInterest)}}>Total Annual Interest: {results.totalAnnualInterest.toLocaleString()} RUB</p>
                            <p style={{color: getColor(results.dailyInterest)}}>Daily Interest: {results.dailyInterest} RUB</p>
                            <p style={{color: getColor(parseFloat(results.netPercentage))}}>Net Percentage: {results.netPercentage}% per year</p>
                        </div>
                    )}
                    <div id="graph">
                        <canvas ref={chartRef}></canvas>
                    </div>
                </div>
            );
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>