<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Net Worth Dynamics Calculator</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        
        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
            font-size: 2rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .entries-container {
            margin-bottom: 20px;
        }
        
        .entry {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 15px;
            margin-bottom: 10px;
            background: #f8f9fa;
            border-radius: 10px;
            border: 2px solid #e9ecef;
            transition: all 0.3s ease;
        }
        
        .entry:hover {
            border-color: #667eea;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.1);
        }
        
        .entry-type {
            font-size: 1.2rem;
            min-width: 100px;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .entry input, .entry select {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.3s;
        }
        
        .entry input:focus, .entry select:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .entry input[type="number"] {
            width: 120px;
        }
        
        .entry select {
            min-width: 120px;
        }
        
        .entry-label {
            font-size: 12px;
            color: #666;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        button {
            padding: 10px 20px;
            cursor: pointer;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            transition: all 0.3s ease;
            font-size: 14px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        .btn-remove {
            background: #ff6b6b;
            color: white;
            padding: 6px 12px;
            font-size: 12px;
        }
        
        .btn-remove:hover {
            background: #ff5252;
        }
        
        .controls {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .projection-control {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .results {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        
        .result-card {
            padding: 20px;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            border-radius: 10px;
            text-align: center;
        }
        
        .result-label {
            font-size: 12px;
            color: #666;
            margin-bottom: 5px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .result-value {
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .result-subtitle {
            font-size: 0.9rem;
            color: #666;
        }
        
        .positive {
            color: #10b981;
        }
        
        .negative {
            color: #ef4444;
        }
        
        .neutral {
            color: #333;
        }
        
        #graph {
            margin-top: 30px;
            padding: 20px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 20px;
                border-radius: 0;
            }
            
            body {
                padding: 0;
            }
            
            .entry {
                flex-direction: column;
                align-items: stretch;
                gap: 10px;
            }
            
            .entry-type {
                font-size: 1.1rem;
            }
            
            .entry input[type="number"], .entry select {
                width: 100%;
            }
            
            .controls {
                flex-direction: column;
                align-items: stretch;
            }
            
            .results {
                grid-template-columns: 1fr;
            }
        }
        
        @media (min-width: 769px) {
            .entry {
                width: 100%;
            }
            
            .container {
                width: 90%;
            }
        }
        
        @media (min-width: 1024px) {
            .container {
                width: 80%;
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        function App() {
            const [entries, setEntries] = useState([
                { id: 0, amount: '', rate: '', type: 'asset', compounding: 'none' }
            ]);
            const [nextId, setNextId] = useState(1);
            const [results, setResults] = useState(null);
            const [projectionYears, setProjectionYears] = useState(10);
            const chartRef = useRef(null);
            const chartInstance = useRef(null);

            const typeConfig = {
                asset: { emoji: 'ðŸ’°', label: 'Asset', sign: 1 },
                debt: { emoji: 'ðŸ’³', label: 'Debt', sign: -1 },
                income: { emoji: 'ðŸ’µ', label: 'Fixed Income', sign: 1 },
                expense: { emoji: 'ðŸ“‰', label: 'Fixed Expense', sign: -1 }
            };

            useEffect(() => {
                const saved = localStorage.getItem('networthCalculatorData');
                if (saved) {
                    try {
                        const { entries: savedEntries, projectionYears: savedYears, nextId: savedNextId } = JSON.parse(saved);
                        setEntries(savedEntries);
                        setProjectionYears(savedYears);
                        setNextId(savedNextId);
                    } catch (e) {
                        console.error('Error loading saved data:', e);
                    }
                }
            }, []);

            useEffect(() => {
                localStorage.setItem('networthCalculatorData', JSON.stringify({ entries, projectionYears, nextId }));
            }, [entries, projectionYears, nextId]);

            const addEntry = () => {
                setEntries([...entries, { id: nextId, amount: '', rate: '', type: 'asset', compounding: 'none' }]);
                setNextId(nextId + 1);
            };

            const removeEntry = (id) => {
                if (entries.length > 1) {
                    setEntries(entries.filter(entry => entry.id !== id));
                } else {
                    alert("At least one entry is required!");
                }
            };

            const updateEntry = (id, field, value) => {
                setEntries(entries.map(entry => {
                    if (entry.id === id) {
                        return { ...entry, [field]: value };
                    }
                    return entry;
                }));
            };

            const calculateFV = (principal, annualRate, years, compounding, isRecurring = false) => {
                if (years === 0) return principal;
                
                if (isRecurring) {
                    // For recurring income/expenses, calculate total accumulated value
                    let total = 0;
                    for (let year = 0; year < years; year++) {
                        // Each year's contribution grows for the remaining years
                        const remainingYears = years - year;
                        if (compounding === 'none') {
                            total += principal * (1 + annualRate * remainingYears);
                        } else {
                            let periodsPerYear = 1;
                            if (compounding === 'annual') periodsPerYear = 1;
                            if (compounding === 'monthly') periodsPerYear = 12;
                            else if (compounding === 'daily') periodsPerYear = 365;
                            const periodRate = annualRate / periodsPerYear;
                            const totalPeriods = remainingYears * periodsPerYear;
                            total += principal * Math.pow(1 + periodRate, totalPeriods);
                        }
                    }
                    return total;
                } else {
                    // For assets and debts
                    if (compounding === 'none') {
                        return principal * (1 + annualRate * years);
                    } else {
                        let periodsPerYear = 1;
                        if (compounding === 'annual') periodsPerYear = 1;
                        if (compounding === 'monthly') periodsPerYear = 12;
                        else if (compounding === 'daily') periodsPerYear = 365;
                        const periodRate = annualRate / periodsPerYear;
                        const totalPeriods = years * periodsPerYear;
                        return principal * Math.pow(1 + periodRate, totalPeriods);
                    }
                }
            };

            const calculate = () => {
                let totalAnnualInterest = 0;
                let totalMonthlyInterest = 0;
                let totalAssets = 0;
                let totalDebts = 0;
                let totalIncome = 0;
                let totalExpenses = 0;

                entries.forEach(entry => {
                    const amount = parseFloat(entry.amount) || 0;
                    const rate = parseFloat(entry.rate) || 0;
                    const annualInterest = amount * (rate / 100);
                    
                    totalAnnualInterest += annualInterest * typeConfig[entry.type].sign;
                    totalMonthlyInterest += Math.abs(annualInterest / 12);

                    switch(entry.type) {
                        case 'asset':
                            totalAssets += amount;
                            break;
                        case 'debt':
                            totalDebts += amount;
                            break;
                        case 'income':
                            totalIncome += amount;
                            break;
                        case 'expense':
                            totalExpenses += amount;
                            break;
                    }
                });

                const netWorth = totalAssets - totalDebts;
                const absNetWorth = Math.abs(netWorth);
                const netPercentage = absNetWorth !== 0 ? (totalAnnualInterest / absNetWorth * 100) : 0;
                const dailyInterest = totalAnnualInterest / 365;

                setResults({
                    netWorth,
                    totalAssets,
                    totalDebts,
                    totalIncome,
                    totalExpenses,
                    totalAnnualInterest,
                    totalMonthlyInterest,
                    dailyInterest,
                    netPercentage
                });

                // Project networth
                const networthData = [];
                for (let year = 0; year <= projectionYears; year++) {
                    let totalFV = 0;
                    
                    entries.forEach(entry => {
                        const amount = parseFloat(entry.amount) || 0;
                        const rate = parseFloat(entry.rate) || 0;
                        const annualRate = rate / 100;
                        const isRecurring = entry.type === 'income' || entry.type === 'expense';
                        
                        const fv = calculateFV(amount, annualRate, year, entry.compounding, isRecurring);
                        totalFV += fv * typeConfig[entry.type].sign;
                    });
                    
                    networthData.push(totalFV);
                }

                // Draw graph
                if (chartInstance.current) {
                    chartInstance.current.destroy();
                }
                const ctx = chartRef.current.getContext('2d');
                chartInstance.current = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: Array.from({ length: projectionYears + 1 }, (_, i) => `Year ${i}`),
                        datasets: [{
                            label: 'Projected Net Worth (RUB)',
                            data: networthData,
                            borderColor: 'rgba(102, 126, 234, 1)',
                            backgroundColor: 'rgba(102, 126, 234, 0.1)',
                            fill: true,
                            tension: 0.4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: true,
                        plugins: {
                            legend: {
                                display: true,
                                position: 'top'
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: false,
                                title: {
                                    display: true,
                                    text: 'Net Worth (RUB)'
                                },
                                ticks: {
                                    callback: function(value) {
                                        return value.toLocaleString() + ' â‚½';
                                    }
                                }
                            },
                            x: {
                                title: {
                                    display: true,
                                    text: 'Years'
                                }
                            }
                        }
                    }
                });
            };

            useEffect(() => {
                calculate();
            }, [entries, projectionYears]);

            const getColorClass = (value) => {
                if (value > 0) return 'positive';
                if (value < 0) return 'negative';
                return 'neutral';
            };

            const formatCurrency = (value) => {
                return new Intl.NumberFormat('ru-RU').format(Math.round(value));
            };

            return (
                <div className="container">
                    <h1>ðŸ’¼ Net Worth Dynamics Calculator</h1>
                    
                    <div className="entries-container">
                        {entries.map(entry => (
                            <div key={entry.id} className="entry">
                                <div className="entry-type">
                                    <span>{typeConfig[entry.type].emoji}</span>
                                    <select
                                        value={entry.type}
                                        onChange={(e) => updateEntry(entry.id, 'type', e.target.value)}
                                    >
                                        <option value="asset">Asset</option>
                                        <option value="debt">Debt</option>
                                        <option value="income">Income</option>
                                        <option value="expense">Expense</option>
                                    </select>
                                </div>
                                
                                <div>
                                    <div className="entry-label">Amount</div>
                                    <input
                                        type="number"
                                        value={entry.amount}
                                        placeholder="0"
                                        onChange={(e) => updateEntry(entry.id, 'amount', e.target.value)}
                                    />
                                </div>
                                
                                <div>
                                    <div className="entry-label">Rate %</div>
                                    <input
                                        type="number"
                                        step="0.1"
                                        value={entry.rate}
                                        placeholder="0"
                                        onChange={(e) => updateEntry(entry.id, 'rate', e.target.value)}
                                    />
                                </div>
                                
                                <div>
                                    <div className="entry-label">Compounding</div>
                                    <select
                                        value={entry.compounding}
                                        onChange={(e) => updateEntry(entry.id, 'compounding', e.target.value)}
                                    >
                                        <option value="none">No Compound</option>
                                        <option value="annual">Annual</option>
                                        <option value="monthly">Monthly</option>
                                        <option value="daily">Daily</option>
                                    </select>
                                </div>
                                
                                <button className="btn-remove" onClick={() => removeEntry(entry.id)}>
                                    Remove
                                </button>
                            </div>
                        ))}
                    </div>
                    
                    <div className="controls">
                        <button className="btn-primary" onClick={addEntry}>
                            + Add Entry
                        </button>
                        <div className="projection-control">
                            <label>Projection Years:</label>
                            <input
                                type="number"
                                value={projectionYears}
                                onChange={(e) => setProjectionYears(parseInt(e.target.value) || 10)}
                                min="1"
                                max="50"
                                style={{width: '80px'}}
                            />
                        </div>
                    </div>
                    
                    {results && (
                        <div className="results">
                            <div className="result-card">
                                <div className="result-label">Net Worth</div>
                                <div className={`result-value ${getColorClass(results.netWorth)}`}>
                                    {formatCurrency(results.netWorth)} â‚½
                                </div>
                            </div>
                            
                            <div className="result-card">
                                <div className="result-label">Total Assets</div>
                                <div className="result-value positive">
                                    {formatCurrency(results.totalAssets)} â‚½
                                </div>
                            </div>
                            
                            <div className="result-card">
                                <div className="result-label">Total Debts</div>
                                <div className="result-value negative">
                                    {formatCurrency(results.totalDebts)} â‚½
                                </div>
                            </div>
                            
                            <div className="result-card">
                                <div className="result-label">Annual Interest</div>
                                <div className={`result-value ${getColorClass(results.totalAnnualInterest)}`}>
                                    {formatCurrency(results.totalAnnualInterest)} â‚½
                                </div>
                                <div className="result-subtitle">
                                    {results.netPercentage.toFixed(2)}% per year
                                </div>
                            </div>
                            
                            <div className="result-card">
                                <div className="result-label">Monthly Interest</div>
                                <div className="result-value neutral">
                                    {formatCurrency(results.totalMonthlyInterest)} â‚½
                                </div>
                                <div className="result-subtitle">
                                    absolute value
                                </div>
                            </div>
                            
                            <div className="result-card">
                                <div className="result-label">Daily Interest</div>
                                <div className={`result-value ${getColorClass(results.dailyInterest)}`}>
                                    {formatCurrency(results.dailyInterest)} â‚½
                                </div>
                            </div>
                            
                            {results.totalIncome > 0 && (
                                <div className="result-card">
                                    <div className="result-label">Fixed Income</div>
                                    <div className="result-value positive">
                                        {formatCurrency(results.totalIncome)} â‚½
                                    </div>
                                    <div className="result-subtitle">per year</div>
                                </div>
                            )}
                            
                            {results.totalExpenses > 0 && (
                                <div className="result-card">
                                    <div className="result-label">Fixed Expenses</div>
                                    <div className="result-value negative">
                                        {formatCurrency(results.totalExpenses)} â‚½
                                    </div>
                                    <div className="result-subtitle">per year</div>
                                </div>
                            )}
                        </div>
                    )}
                    
                    <div id="graph">
                        <canvas ref={chartRef}></canvas>
                    </div>
                </div>
            );
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>